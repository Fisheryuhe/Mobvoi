<?xml version="1.0" encoding="utf-8" ?>
<beans xmlns="http://www.springframework.org/schema/beans"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
	<bean id="job" class="com.mobvoi.be.usercenter.datamining.UserCenterDataMiningJob">
		<property name="logTool" ref="logTool" />
		<property name="extractorTool" ref="extractorTool" />
		<property name="handlerTool" ref="handlerTool" />
		<property name="uploaderTool" ref="uploaderTool" />
		<property name="rootPath" value="./location" />
		<property name="lockPath" value="./location/lock" />
		<property name="statusPath" value="./location/status" /> 
	</bean>
	
	<bean id="logTool" class="com.mobvoi.be.usercenter.datamining.log.LogDownloadTool">
		<property name="logPath" value="./location/log" />
		<property name="job" ref="job" />
		<property name="name2Pattern">
			<map>
				<entry key="heartbeat" value="heartbeat.record.*" />
			</map>
		</property>
	</bean>
	
	<bean id="extractorTool" class="com.mobvoi.be.usercenter.datamining.extract.DataExtractorTool">
		<property name="logPath" value="./location/log" />
		<property name="dataPath" value="./location/data" />
		<property name="inMemorySize" value="2000000" />
		<property name="extractors">
			<map>
				<entry key="heartbeat" value-ref="heartbeatLocationExtractor" />
			</map>
		</property>
	</bean>
	
	<bean id="heartbeatLocationExtractor" class="com.mobvoi.be.usercenter.datamining.extract.HeartbeatLocationExtractor" />

	<bean id="handlerTool" class="com.mobvoi.be.usercenter.datamining.handle.DataHandlerTool">
		<property name="dataPath" value="./location/data" />
		<property name="resultPath" value="./location/result" />
		<property name="dataClass" value="com.mobvoi.be.usercenter.datamining.model.LocationData" />
		<property name="handlers">
			<map>
				<entry key="activity_district" value-ref="districtHandler" />
				<entry key="home" value-ref="homeLocationHandler" />
				<!-- <entry key="working_time" value-ref="workingTimeHandler" />  -->
				<entry key="company" value-ref="CompanyHandler" />
				<entry key="active_location" value-ref="ActiveLocationHandler" />
			</map>
		</property>
	</bean>
	
	<bean id="districtHandler" class="com.mobvoi.be.usercenter.datamining.handle.DistrictHandler" />
	
	<bean id="homeLocationHandler" class="com.mobvoi.be.usercenter.datamining.handle.HomeLocationHandler" />
	
	<!-- <bean id="workingTimeHandler" class="com.mobvoi.be.usercenter.datamining.handle.TimeTraceHandler" /> -->

	<bean id="CompanyHandler" class="com.mobvoi.be.usercenter.datamining.handle.CompanyHandler" />
	
	<bean id="ActiveLocationHandler" class="com.mobvoi.be.usercenter.datamining.handle.ActiveLocationHandler" />
	
	<bean id="uploaderTool" class="com.mobvoi.be.usercenter.datamining.upload.ResultUploaderTool">
		<property name="resultPath" value="./location/result" />
		<property name="uploaders">
			<map>
				<entry key="activity_district" value-ref="districtUploader" />
				<entry key="home" value-ref="homeLocationUploader" />
				<entry key="company" value-ref="CompanyUploader" />
				<entry key="active_location" value-ref="ActiveLocationUploader" />
			</map>
		</property>
		<property name="classes">
			<map>
				<entry key="activity_district" value="com.mobvoi.be.usercenter.datamining.model.DistrictData" />
				<entry key="home" value="com.mobvoi.be.usercenter.userinfo.model.LocationDetailData" />
				<entry key="company" value="com.mobvoi.be.usercenter.userinfo.model.LocationDetailData" />
				<entry key="active_location" value="com.mobvoi.be.usercenter.datamining.model.ActiveLocationData" />
			</map>
		</property>
	</bean>
	
	<bean id="districtUploader" class="com.mobvoi.be.usercenter.datamining.upload.DistrictUploader" />

	<bean id="homeLocationUploader" class="com.mobvoi.be.usercenter.datamining.upload.HomeLocationUploader" />
	
	<bean id="CompanyUploader" class="com.mobvoi.be.usercenter.datamining.upload.CompanyUploader" />
	
	<bean id="ActiveLocationUploader" class="com.mobvoi.be.usercenter.datamining.upload.ActiveLocationUploader" />
	
</beans>
